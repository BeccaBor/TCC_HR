{{!-- folhaPagamento_sistema/frontend/views/folhapaga.handlebars --}}
<link rel="stylesheet" href="../css/folhapaga.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="page-wrapper">
  {{> navbar }}
  <div class="cola-layout">
    {{> sidebar}}
    <main class="p-4" data-colaborador-id="{{colaborador.id}}">
      <a href="/gestor/folhadepagamento" class="btn btn-sm btn-outline-secondary mb-3">← Voltar</a>

      <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
          <h1 class="text-white mb-2" style="font-size: 1.5rem; font-weight: 700;">Folha — <span id="nome-colaborador">{{colaborador.nome}}</span></h1>
          <p style="color: rgba(255,255,255,0.7);">Editar dados do colaborador e calcular folha</p>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="glass-card p-3">
            <form id="form-folha">
              <input type="hidden" id="colaboradorId" name="colaboradorId" value="{{colaborador.id}}" />

              <div class="mb-2">
                <label class="text-white">Salário Base</label>
                <input type="number" step="0.01" id="salario" name="salario" class="glass-input"
                       value="{{colaborador.salario}}">
              </div>

              <div class="mb-2">
                <label class="text-white">Horas Diárias</label>
                <input type="number" step="0.1" id="horas_diarias" name="horas_diarias" class="glass-input"
                       value="{{colaborador.horas_diarias}}">
              </div>

              <div class="mb-2">
                <label class="text-white">Dependentes</label>
                <input type="number" id="dependentes" name="dependentes" class="glass-input"
                       value="{{colaborador.dependentes}}">
              </div>

              <div class="mb-2">
                <label class="text-white">Horas Extras (mês)</label>
                <input type="number" step="0.1" id="horas_extras" name="horas_extras" class="glass-input" value="0">
              </div>

              <div class="d-flex gap-2 mt-3">
                <button type="button" id="btn-calcular" class="glass-button">Calcular</button>
                <button type="button" id="btn-salvar" class="glass-button-primary">Salvar Alterações</button>
              </div>
            </form>
          </div>
        </div>

        <div class="col-md-6">
          <div class="glass-card p-3">
            <h6 class="text-white">Resultado do Cálculo</h6>
            <div id="resultado-calculo" class="mt-3">
              <p class="text-white">Salário Bruto: <span id="r-salario">R$ 0,00</span></p>
              <p class="text-white">INSS: <span id="r-inss">R$ 0,00</span></p>
              <p class="text-white">IRRF: <span id="r-irrf">R$ 0,00</span></p>
              <p class="text-white">FGTS: <span id="r-fgts">R$ 0,00</span></p>
              <p class="text-white"><strong>Total Líquido: <span id="r-liquido">R$ 0,00</span></strong></p>
            </div>
            <div class="mt-3">
              <button id="btn-gerar-holerite" class="glass-button" style="display:none;">Gerar Holerite (PDF)</button>
              <button id="btn-processar-persiste" class="glass-button-primary" style="display:none;">Processar e Persistir</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script src="/public/js/folhapaga.js"></script>
<link rel="stylesheet" href="../css/folhapaga.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="page-wrapper">
  {{> navbar }}
  <div class="cola-layout">
    <main class="p-4">
      <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
          <h1 class="text-white mb-2">Folha de Pagamento - {{colaborador.nome}}</h1>
          <p style="color: rgba(255,255,255,0.7);">Editar dados para cálculo</p>
        </div>
      </div>

      <div class="glass-card">
        <form id="form-folha" method="post" action="/api/gestor/calcular">
          <input type="hidden" name="usuarioId" value="{{colaborador.id}}">
          <div class="mb-3">
            <label>Salário Bruto</label>
            <input name="salarioBruto" type="number" step="0.01" class="glass-input" value="{{colaborador.salario}}">
          </div>

          <!-- adicione aqui outros campos que queira (horas extras, descontos, VT etc.) -->
          <div class="d-grid mt-3">
            <button type="submit" class="glass-button-primary">Calcular Folha</button>
          </div>
        </form>

        <div id="resultado" class="mt-4"></div>
      </div>
    </main>
  </div>
</div>

<script>
  // intercepta submissão e mostra resultado sem recarregar (opcional)
  document.getElementById('form-folha')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);
    const payload = Object.fromEntries(data);
    try {
      const resp = await fetch('/api/gestor/calcular', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const json = await resp.json();
      if (json && json.success) {
        document.getElementById('resultado').innerText = JSON.stringify(json.result, null, 2);
      } else {
        document.getElementById('resultado').innerText = 'Erro no cálculo';
      }
    } catch (err) {
      console.error(err);
      document.getElementById('resultado').innerText = 'Erro';
    }
  });
</script>
