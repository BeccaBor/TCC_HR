{{> navbar }}

<link rel="stylesheet" href="/css/solicitacoes.css">

<main class="gestor-page container-gestao" role="main" aria-label="Painel de solicita√ß√µes">
  <aside class="sidebar" aria-label="Filtros laterais">
    <h4>Painel Gestor</h4>
    <p>Visualize e gerencie todas as solicita√ß√µes agrupadas por setor e colaborador.</p>

    <div class="box">
      <button id="btnRefreshSolicitacoes" class="btn" type="button">Atualizar</button>
      <button id="btnFilterTodos" class="btn" type="button">Todos</button>
    </div>

    <div class="box mt-3">
      <h5>Filtros r√°pidos</h5>
      <div class="filtros" role="toolbar" aria-label="Filtros de status">
        <button data-status="all" class="filtro-btn ativo" type="button">Todas</button>
        <button data-status="pendente" class="filtro-btn" type="button">Pendente</button>
        <button data-status="aprovada" class="filtro-btn" type="button">Aprovada</button>
        <button data-status="reprovada" class="filtro-btn" type="button">Reprovada</button>
      </div>

      <hr/>

      <h6 class="mt-2">Filtrar por setor</h6>
      <div id="setorFilters" class="setor-filters" aria-live="polite" aria-atomic="true">
        <!-- setores ser√£o preenchidos pelo JS -->
        <div class="small muted">Carregando setores...</div>
      </div>
    </div>
  </aside>

  <section class="main-panel">
    <header class="header-panel liquid-glass">
      <div class="header-text">
        <h1>Solicita√ß√µes da Empresa</h1>
        <p class="small">Agrupadas por setor ‚Üí colaborador. Clique sobre qualquer solicita√ß√£o para ver detalhes e anexos.</p>
      </div>

      <div class="acoes">
        <div class="filter-group">
          <input id="buscaSolicitacoes" class="glass-input busca-input" placeholder="Pesquisar por colaborador, tipo ou texto..." aria-label="Pesquisar solicita√ß√µes" />
          <div style="display:flex; gap:8px; align-items:center;">
            <button id="btnToggleView" class="btn small" title="Alternar visualiza√ß√£o" type="button">Lista</button>
          </div>
        </div>
      </div>
    </header>

    <section id="setoresWrapper" class="setores-wrapper" aria-live="polite" aria-busy="true" tabindex="0">
      <!-- conte√∫do ser√° injetado pelo JS (cards ou list view) -->
      <div class="placeholder">Carregando solicita√ß√µes...</div>
      <noscript class="small mt-3" style="display:block; color:var(--muted);">
        JavaScript est√° desabilitado ‚Äî ative para visualizar e gerenciar solicita√ß√µes.
      </noscript>
    </section>
  </section>
</main>

<!-- Modal: detalhes da solicita√ß√£o -->
<div class="modal fade" id="modalSolicitacao" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content liquid-glass p-4">
      <div class="modal-header">
        <h5 id="modalSolicitacaoTitulo">Solicita√ß√£o</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div class="detalhes-solicitacao">
          <div class="meta d-flex gap-3 wrap">
            <div><strong>Tipo:</strong> <span id="modalSolicitacaoTipo"></span></div>
            <div><strong>Status:</strong> <span id="modalSolicitacaoStatus"></span></div>
            <div><strong>Data:</strong> <span id="modalSolicitacaoData"></span></div>
          </div>

          <hr/>

          <div class="conteudo">
            <h6>Descri√ß√£o</h6>
            <p id="modalSolicitacaoDescricao"></p>

            <h6 class="mt-3">Anexos</h6>
            <div id="modalSolicitacaoAnexos" class="anexos-list" aria-live="polite">
              <!-- links de anexos ser√£o inseridos pelo JS -->
            </div>
          </div>

          <hr/>

          <div class="colaborador-info d-flex gap-3 align-items-center">
            <img id="modalSolicitacaoFoto" src="/img/fundofoda.png" onerror="this.src='/img/fundofoda.png'" alt="foto" class="colab-foto">

            <div>
              <div id="modalSolicitacaoColabNome" class="nome"></div>
              <div id="modalSolicitacaoColabSetor" class="setor small"></div>
              <div id="modalSolicitacaoColabCargo" class="cargo small"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="flex-left">
          <button id="btnAprovar" class="btn btn-success" type="button">Aprovar</button>
          <button id="btnReprovar" class="btn btn-danger" type="button">Reprovar</button>
        </div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: perfil do colaborador -->
<!-- Modal: perfil do colaborador -->
<div class="modal fade" id="modalColaboradorGestor" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content liquid-glass p-4">
      <div class="modal-header">
        <h5>Colaborador</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="colab-full text-center">
          <!-- üëá trocado o id -->
          <img id="colabModalFoto"
               src="/img/fundofoda.png"
               onerror="this.src='/img/fundofoda.png'"
               alt="foto do colaborador"
               class="colab-foto">

          <h4 id="colabModalNome"></h4>
          <p id="colabModalCargoSetor" class="small"></p>
          <p id="colabModalInfoExtra" class="small"></p>

          <h6 class="mt-3">Solicita√ß√µes do colaborador</h6>
          <div id="colabModalSolicitacoes" class="colab-solicitacoes">
            <!-- lista simples -->
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="btnFecharColabModal" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>


<script>
  // BACKEND_URL ‚Äî se o server injetar essa vari√°vel ela ser√° usada pelo JS; caso contr√°rio o JS usa rotas relativas
  const BACKEND_URL = '{{BACKEND_URL}}' || '';

  // Op√ß√£o: o servidor pode injetar JSON inicial (evita fetch inicial). Se desejar usar, passe
  // `initialSolicitacoesJSON` e/ou `initialSetoresJSON` ao renderizar a view (j√° stringificados).
  {{#if initialSolicitacoesJSON}}
  window.__INITIAL_SOLICITACOES = {{{initialSolicitacoesJSON}}};
  {{/if}}
  {{#if initialSetoresJSON}}
  window.__INITIAL_SETORES = {{{initialSetoresJSON}}};
  {{/if}}
</script>

<script src="/js/solicitacoesGestor.js" defer></script>
