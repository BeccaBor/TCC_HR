<link rel="stylesheet" href="../css/folhapaga.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="page-wrapper">
  {{> navbar }}
  
  <div class="cola-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div>
        <h3>Setores</h3>
        <ul id="setores-list">
          <li><a href="#" data-setor="Todos" class="sidebar-link sidebar-link-active"><i class="bi bi-people"></i> Todos</a></li>
          <!-- Setores serão carregados via JS -->
        </ul>

        <h3 style="margin-top: 2rem;">Gestão</h3>
        <ul>
          <li><a href="#relatorios" class="sidebar-link sidebar-link-default"><i class="bi bi-graph-up"></i> Relatórios</a></li>
          <li><a href="#beneficios" class="sidebar-link sidebar-link-default"><i class="bi bi-credit-card"></i> Benefícios</a></li>
          <li><a href="#holerite" class="sidebar-link sidebar-link-default"><i class="bi bi-card-text"></i> Holerite</a></li>
          <li><button id="btn-config" class="sidebar-link sidebar-link-default"><i class="bi bi-gear"></i> Configurações</button></li>
        </ul>
      </div>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="p-4">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
          <h1 class="text-white mb-2" style="font-size: 1.875rem; font-weight: 700;">Folha de Pagamento</h1>
          <p style="color: rgba(255,255,255,0.7);">Gerencie salários, benefícios e relatórios da sua equipe</p>
        </div>
        <div class="d-flex gap-3">
          <button class="glass-button"><i class="bi bi-download"></i> Exportar</button>
          <button class="glass-button-primary" onclick="window.location.href='/gestor/gerenciamento'">
            <i class="bi bi-plus-lg"></i> Novo Funcionário
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="stat-icon gradient-blue-cyan"><i class="bi bi-people text-white"></i></div>
              <span class="text-success" style="font-size: 0.875rem; font-weight: 500;" id="stat-percentual">--</span>
            </div>
            <div class="col-md-4">
                <div class="card text-left">
                    <div class="card-body">
                        <h4 class="card-subtitle text-muted">Folha Atual</h4>
                        <h5 class="card-title">{{folhaAtual}}</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-left">
                    <div class="card-body">
                        <h6 class="card-subtitle text-muted">Total da Folha</h6>
                        <h5 class="card-title">{{totalFolha}}</h5>
                    </div>
                </div>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h6 class="fw-bold mb-3">Gerar Nova Folha</h6>
                        <form>
                            <div class="mb-3">
                                <label>Mês/Ano</label>
                                <input type="date" class="form-control" placeholder="MM/AAAA">
                            </div>
                            <div class="mb-3">
                                <label for="tipoFolha">Selecione o tipo de folha</label>
                                <select id="tipoFolha" class="form-select">
                                    <option>Tipos de folha</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                 <label for="departamento">Selecione o departamento</label>
                                <select id="departamento" class="form-select">
                                    <option>Todos departamentos</option>
                                </select>
                            </div>
                            <div class="bg-light p-3 rounded mb-3">
                                <p class="mb-1">Cálculos Inclusos:</p>
                                <ul class="list-inline mb-0">
                                    <li class="col-4 list-inline-item">
                                        <div class="row justify-content-around">
                                            INSS
                                        </div>
                                    </li>
                                    <li class="col-4 list-inline-item">
                                        <div class="row justify-content-around">
                                            FGTS
                                        </div>
                                    </li>
                                    <li class="col-4 list-inline-item">
                                        <div class="row justify-content-around">
                                            IRRF
                                        </div>
                                    </li>
                                    <li class="col-4 list-inline-item">
                                        <div class="row justify-content-around">
                                            Vale Transporte
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <button type="submit" class="btn btn-dark w-100">Gerar Folha de Pagamento</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold">Folhas Recentes</h6>
                            <a href="#">Ver todas</a>
                        </div>
                        <ul class="list-group">
                            {{#each folhasRecentes}}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <i class="bi {{this.icone}} fs-4 me-3"></i>
                                    <div>
                                        <div>{{this.data}}</div>
                                        <small class="text-muted">{{this.tipo}}</small>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div>{{this.valor}}</div>
                                    <span
                                        class="badge {{#ifCond this.status '==' 'Processada'}}bg-success{{else}}bg-warning text-dark{{/ifCond}}">
                                        {{this.status}}
                                    </span>

                                </div>
                            </li>
                            {{/each}}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3 my-4">

            <div class="card my-4">
                <div class="card-body">
                    <h6 class="fw-bold mb-3">Detalhamento da Folha Atual</h6>
                    <p class="text-muted">Breakdown dos cálculos e descontos</p>

                    <div class="row text-center">
                        <div class="col-md-3">
                            <i class="bi bi-wallet2 fs-4"></i>
                            <p>Salário Bruto<br><strong>R$ {{resumoFolha.totalSalarioBruto}}</strong></p>
                        </div>
                        <div class="col-md-3">
                            <i class="bi bi-shield-lock fs-4"></i>
                            <p>INSS<br><strong>-R$ {{resumoFolha.totalINSS}}</strong></p>
                        </div>
                        <div class="col-md-3">
                            <i class="bi bi-percent fs-4"></i>
                            <p>IRRF<br><strong>-R$ {{resumoFolha.totalIRRF}}</strong></p>
                        </div>
                        <div class="col-md-3">
                            <i class="bi bi-bank fs-4"></i>
                            <p>FGTS<br><strong>-R$ {{resumoFolha.totalFGTS}}</strong></p>
                        </div>
                    </div>
                    <hr>
                    <div class="text-end mt-3">
                        <h5>Total Líquido: <strong>R$ {{resumoFolha.totalLiquido}}</strong></h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

{{!-- <script>
  document.addEventListener("DOMContentLoaded", ()=>{
    const token= localStorage.getItem("token") || sessionStorage.getItem("token")

    if (!token){
      //barra a pessoa que não tiver o token, vai fazer a pessoa voltar a pagina do login
      window.location.href= "/"
      return
    }

    //vai testar o token eno servidor pra evitar de ser expirado 

    fetch("http://localhost:3001/colaborador/dados", {
      headers: {"Authorization": `Bearer $ {token}`}
    }).then(res=> {
      if(!res.ok){
        localStorage.removeItem("token")
        sessionStorage.removeItem("token")
        window.locationhref = "/"
      }
    })
    .catch(()=>{
      
      window.location.href = "/"
    })
  })
</script> --}}